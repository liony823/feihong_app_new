# 飞宏应用模块化系统 (改进版)

## 概述

该模块化系统允许根据后端返回的配置动态加载不同的应用模块，每个模块负责管理自己的路由和服务。

## 核心理念

- **模块自治**: 每个模块负责定义和提供自己的路由和服务
- **动态加载**: 根据后端配置，只加载需要的模块
- **解耦**: 主应用只负责协调模块，不关心具体模块的实现细节

## 模块结构

每个模块应包含：

- **setup.dart**: 包含模块的初始化逻辑
- **getRoutes()**: 返回该模块的路由配置
- **模块入口文件**: 导出模块的公共API (如 auth.dart)

## 核心组件

### 1. 模块管理器 (app_module_provider.dart)

- 负责从后端获取模块配置列表
- 确定哪些模块应该被加载
- 提供模块状态的查询方法

### 2. 模块服务管理器 (module_service_provider.dart)

- 根据启用的模块初始化相应的服务
- 从各个模块收集路由配置
- 提供统一的路由列表

### 3. 路由器 (router.dart)

- 使用模块服务管理器提供的路由列表
- 简化为仅协调角色，不直接包含路由定义

## 工作流程

1. 应用启动时初始化基础模块（公共模块和核心模块）
2. 从后端获取启用的模块列表
3. 根据启用的模块，初始化各模块的服务
4. 收集各模块提供的路由配置
5. 应用统一的路由配置

## 示例：如何添加新模块

1. 创建新模块，包含setup.dart和路由定义
2. 在新模块中实现getRoutes()方法
3. 在app_module_provider.dart中添加新模块映射
4. 在module_service_provider.dart中添加新模块初始化和路由获取逻辑

## 优势

- **松耦合**: 各模块独立发展，无紧密依赖
- **按需加载**: 只加载需要的模块，提高性能
- **易扩展**: 添加新模块不需要修改主应用核心逻辑
- **自治性**: 每个模块控制自己的路由和服务，便于独立开发和测试 